<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Security-Policy" content="frame-ancestors 'self' https://trello.com;">
  <script src="https://p.trellocdn.com/power-up.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 10px; }
    label { font-weight: bold; display: block; margin-top: 8px; }
    input, select { width: 100%; padding: 5px; margin-top: 4px; }
    button { margin-top: 10px; padding: 8px; background: #0079bf; color: white; border: none; cursor: pointer; }
  </style>
</head>
<body>
  <h3>Custom Fields</h3>

  <label>Number Input:</label>
  <input type="number" id="custom-number">

  <label>Priority:</label>
  <select id="priority"></select>

  <label>Task Type:</label>
  <select id="task-type"></select>

  <label>Client Name:</label>
  <select id="client-name"></select>

  <button onclick="saveData()">Save</button>

  <script>
    var t = window.TrelloPowerUp.iframe();
t.signUrl("https://ffadh.github.io/trello-powerup/card.html");


    function saveData() {
      t.set('card', 'shared', 'customFields', {
        number: document.getElementById("custom-number").value,
        priority: document.getElementById("priority").value,
        task: document.getElementById("task-type").value,
        client: document.getElementById("client-name").value
      }).then(() => t.closePopup());
    }

    function loadSettings() {
      t.get('board', 'shared', 'settings').then(settings => {
        if (!settings) return;
        ["priority", "task-type", "client-name"].forEach(id => {
          let select = document.getElementById(id);
          select.innerHTML = "";
          (settings[id] || []).forEach(option => {
            let opt = document.createElement("option");        
            opt.value = opt.textContent = option;
            select.appendChild(opt);
          });
        });
      });
    }

    t.get('card', 'shared', 'customFields').then(data => {
      if (data) {
        document.getElementById("custom-number").value = data.number || "";
        document.getElementById("priority").value = data.priority || "";          
        document.getElementById("task-type").value = data.task || "";
        document.getElementById("client-name").value = data.client || "";
      }
    });

    loadSettings();
  </script>
</body>
</html>
